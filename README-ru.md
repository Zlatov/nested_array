# nested_array

üéâ –ú–æ–∏ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è! –í—ã—à–ª–∞ –≤–µ—Ä—Å–∏—è 3.0.

–ì–µ–º nested_array –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –ø–ª–æ—Å–∫–∏–π –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–π
—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤, –∞ —Ç–∞–∫ –∂–µ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –¥–µ—Ä–µ–≤—å—è —Ñ–æ—Ä–º–∏—Ä—É—è
HTML –≤—ë—Ä—Å—Ç–∫—É –∏–ª–∏ –ø—Å–µ–≤–¥–æ–≥—Ä–∞—Ñ–∏–∫—É.

–î—Ä–µ–≤–æ–≤–∏–¥–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–ø–∏—Å–∞–Ω–∞ –ø–æ —à–∞–±–ª–æ–Ω—É –°–ø–∏—Å–∫–∞ —Å–º–µ–∂–Ω–æ—Å—Ç–∏
(Adjacency List), —Ç–æ –µ—Å—Ç—å –≤ –∫–∞–∂–¥–æ–º —É–∑–ª–µ —É–∫–∞–∑–∞–Ω –ø—Ä–µ–¥–æ–∫.

–ß—Ç–æ –º—ã –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å:




## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –î–æ–±–∞–≤—Ç–µ —Å—Ç—Ä–æ–∫—É –≤ —Ñ–∞–π–ª _Gemfile_ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```ruby
# –†–∞–±–æ—Ç–∞ —Å –¥—Ä–µ–≤–æ–≤–∏–¥–Ω—ã–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏.
gem "nested_array", "~> 3.0"
```

–ò –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `bundle install`.

2. –ï—Å–ª–∏ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–æ–º–Ω—ã–µ CSS —Å—Ç–∏–ª–∏ –≥–µ–º–∞, –¥–æ–±–∞–≤—Ç–µ –≤
—Ñ–∞–π–ª _app/assets/stylesheets/application.scss_:

```css
/* –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥—Ä–µ–≤–æ–≤–∏–¥–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤. */
@import "nested_array";
```




## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏

–î–æ–ø—É—Å—Ç–∏–º, –µ—Å—Ç—å –º–∞—Å—Å–∏–≤ —Ö—ç—à, –≥–¥–µ —Ö—ç—à —ç—Ç–æ —É–∑–µ–ª –¥–µ—Ä–µ–≤–∞. –£ –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞ –µ—Å—Ç—å
–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä `id` –∏ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —É–∑–µ–ª `parent_id`.

–ù–µ–æ–±—Ö–æ–¥–∏–º –º–∞—Å—Å–∏–≤ –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞ –ø–µ—Ä–≤–æ–º —É—Ä–æ–≤–Ω–µ –±—É–¥—É—Ç —Ç–æ–ª—å–∫–æ –∫–æ—Ä–Ω–µ–≤—ã–µ —É–∑–ª—ã —É –∫–æ—Ç–æ—Ä—ã—Ö
–¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã –ø–æ–º–µ—â–µ–Ω—ã –≤ –ø–æ–ª–µ `children`.

–ü—Ä–∏–º–µ—Ä:

```ruby
flat = [
  {'id' => 3, 'parent_id' => nil},
  {'id' => 2, 'parent_id' => 1},
  {'id' => 1, 'parent_id' => nil}
]
nested = a.to_nested
pp nested
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–≤–æ–¥–∞:

```
[#<OpenStruct id=3, parent_id=nil, origin={"id"=>3, "parent_id"=>nil}, level=0>,
 #<OpenStruct id=1, parent_id=nil, children=[#<OpenStruct id=2, parent_id=1, origin={"id"=>2, "parent_id"=>1}, level=1>], origin={"id"=>1, "parent_id"=>nil}, level=0>]
```

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —É–∑–ª—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π –æ–±—ä–µ–∫—Ç—ã OpenStruct —É –∫–æ—Ç–æ—Ä—ã—Ö —Ç–∞–∫–∏–µ –∂–µ –ø–æ–ª—è
–∫–∞–∫ —É –∏—Å—Ö–æ–¥–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (id, parent_id) –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è children, origin
–∏ level.

–í –∫–∞—á–µ—Å—Ç–≤–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö —É–∑–ª–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å –∏ –æ–±—ä–µ–∫—Ç—ã ActiveRecord.

```ruby
a = Catalog.create!(name: 'Electronics')
b = Catalog.create!(name: 'Video Projectors', parent: a)

catalogs = Catalog.all.to_a
nested = catalogs.to_nested
pp nested
```

```
[#<OpenStruct id=1, parent_id=nil, name="Electronics", origin=#<Catalog id: 1, name: "Electronics", parent_id: nil>, children=[#<OpenStruct id=2, parent_id=1, name="Video Projectors", origin=#<Catalog id: 2, name: "Video Projectors", parent_id: 1>, level=1>], level=0>]
```

–¢–µ–ø–µ—Ä—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ –æ–±—ä–µ–∫—Ç ActiveRecord, –∞ —É–∑–µ–ª (OpenStruct) —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–ª
–ø–æ–ª–µ `name` –æ—Ç ActiveRecord –æ–±—ä–µ–∫—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä –∫–æ–¥ `nested.first.name ==
nested.first.origin.name` –≤–µ—Ä–Ω—ë—Ç `true`.

<sub>–ú–µ—Ç–æ–¥ `.to_nested` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç–æ–¥ `object.serializable_hash`, —á—Ç–æ–±—ã –≤ –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π –æ–±—ä–µ–∫—Ç–∞.</sub>


### –í—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö





## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≥–µ–º–∞ –∑–∞–º–µ–Ω–∏—Ç–µ –≤ —Å—Ç—Ä–æ–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
(—Ñ–∞–π–ª Gemfile) –≤—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç (–≤–µ—Ä—Å–∏—é) –Ω–∞ –æ–ø—Ü–∏—é path:

```rb
# Gemfile
# –†–∞–±–æ—Ç–∞ —Å –¥—Ä–µ–≤–æ–≤–∏–¥–Ω—ã–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏
gem "nested_array", path: "../nested_array"
```
